<h1 id="getting-started">Getting Started</h1>
<p>This documentation is written about <strong>Getting Started</strong> of cReComp.<br />
So, please install cReComp following the URL.<br />
<a href="https://github.com/kazuyamashi/cReComp.git">Github repositry kazuyamashi/cReComp</a> ### 1. Before start Please confirm <code>sonic_sensor.v</code> in <code>/verilog</code> (directory). This file described with <strong>Verilog HDL</strong>. Such file is a target for componentization and this is called <strong>user logic</strong> in cReComp.</p>
<div class="sourceCode"><pre class="sourceCode verilog"><code class="sourceCode verilog"><span class="co">//  verilog/sonic_sensor.v</span>
<span class="ot">`timescale 1ns / 1ps</span>
<span class="kw">module</span> sonic_sensor(
    <span class="dt">input</span> clk,
    <span class="dt">input</span> rst,
    <span class="dt">input</span> req,
    <span class="dt">output</span> [<span class="dv">0</span>:<span class="dv">0</span>] busy,
    <span class="dt">inout</span> sig,
    <span class="dt">output</span> finish,
    <span class="dt">output</span> [<span class="dv">31</span>:<span class="dv">0</span>] out_data
);
    <span class="dt">parameter</span> STATE_INIT            = <span class="dv">0</span>,
                 STATE_IDLE         = <span class="dv">1</span>,
                 STATE_OUT_SIG      = <span class="dv">2</span>,
                 STATE_OUT_END      = <span class="dv">3</span>,
                 STATE_WAIT750      = <span class="dv">4</span>,
                 STATE_IN_SIG_WAIT  = <span class="dv">5</span>,
                 STATE_IN_SIG       = <span class="dv">6</span>,
                 STATE_IN_SIG_END   = <span class="dv">7</span>,
                 STATE_WAIT200      = <span class="dv">8</span>,
                 STATE_PROCESS_END  = <span class="dv">9</span>;
    <span class="dt">reg</span> [<span class="dv">3</span>:<span class="dv">0</span>] state;
    <span class="dt">reg</span> [<span class="dv">31</span>:<span class="dv">0</span>] echo;
.
.
.</code></pre></div>
<h3 id="template-generation">2. Template generation</h3>
<p>Let's generate a template file for configuration of componentization with cReComp. Then, please specify path to user logic (sonic_sensor.v) and name of template file on command line.</p>
<pre><code>$ crecomp -u sonic_sensor.v -p sensor_ctl.py</code></pre>
<p>When generation completed successfully, <code>sensor_ctl.py</code> has been described such as the following code with Python.<br />
The description is generated automatically by cReComp.<br />
The <code>Sonic_sensor</code> class has information of user logic (sonic_sensor.v): module name, signals (input, output, inout), instance name, path to itself, and the assignment of each signal. The class mast be inherited <code>crecomp.userlogic.Util</code> class.</p>
<p>In addition, each imported module functions are shown in following list.</p>
<ul>
<li>userlogic (as ul)
<ul>
<li>For analysis of target user logic. And, base class (<code>Util</code>) was defined. This module uses veriloggen, pyverilog, iveriog.</li>
</ul></li>
<li>component (as cp)
<ul>
<li><code>Component</code> class was defined in this module. The class is the most important and it has all of configuration data in componentization.</li>
</ul></li>
<li>verilog (as vl)
<ul>
<li>For code generation of Verilog HDL. This module uses jinja2.</li>
</ul></li>
<li>communication (as com)
<ul>
<li>Some classes was defined in this module. Using the classes, developer can configure to communicate between CPU and FPGA on FPGA component.</li>
</ul></li>
</ul>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="co">#!/usr/bin/python</span>
<span class="co"># -*- coding: utf-8 -*-</span>

<span class="im">import</span> crecomp.userlogic <span class="im">as</span> ul
<span class="im">import</span> crecomp.component <span class="im">as</span> cp
<span class="im">import</span> crecomp.verilog <span class="im">as</span> vl
<span class="im">import</span> crecomp.communication <span class="im">as</span> com

<span class="kw">class</span> Sonic_sensor(ul.Util):

    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>,uut):
        <span class="va">self</span>.name <span class="op">=</span> <span class="st">&quot;sonic_sensor&quot;</span>
        <span class="va">self</span>.filepath <span class="op">=</span> <span class="st">&quot;../verilog/sonic_sensor.v&quot;</span>
        <span class="va">self</span>.uut <span class="op">=</span> uut
        <span class="va">self</span>.ports <span class="op">=</span>[
        vl.Input(<span class="st">&quot;clk&quot;</span>, <span class="dv">1</span>),
        vl.Input(<span class="st">&quot;rst&quot;</span>, <span class="dv">1</span>),
        vl.Input(<span class="st">&quot;req&quot;</span>, <span class="dv">1</span>),
        vl.Output(<span class="st">&quot;busy&quot;</span>, <span class="dv">1</span>),
        vl.Inout(<span class="st">&quot;sig&quot;</span>, <span class="dv">1</span>),
        vl.Output(<span class="st">&quot;finish&quot;</span>, <span class="dv">1</span>),
        vl.Output(<span class="st">&quot;out_data&quot;</span>, <span class="dv">32</span>)
        ]
        <span class="va">self</span>.assignlist <span class="op">=</span> {}

<span class="co"># Please describe your component</span>

sonic_sensor <span class="op">=</span> Sonic_sensor(<span class="st">&quot;uut&quot;</span>)
sonic_sensor.assign(<span class="st">&quot;clk&quot;</span>,<span class="st">&quot;&quot;</span>)
sonic_sensor.assign(<span class="st">&quot;rst&quot;</span>,<span class="st">&quot;&quot;</span>)
sonic_sensor.assign(<span class="st">&quot;req&quot;</span>,<span class="st">&quot;&quot;</span>)
sonic_sensor.assign(<span class="st">&quot;busy&quot;</span>,<span class="st">&quot;&quot;</span>)
sonic_sensor.assign(<span class="st">&quot;sig&quot;</span>,<span class="st">&quot;&quot;</span>)
sonic_sensor.assign(<span class="st">&quot;finish&quot;</span>,<span class="st">&quot;&quot;</span>)
sonic_sensor.assign(<span class="st">&quot;out_data&quot;</span>,<span class="st">&quot;&quot;</span>)</code></pre></div>
<h3 id="configuration-for-componentization">3. Configuration for componentization</h3>
<p>Developer can configure for componentization, using framework of cReComp on template file (sensor_ctl.py).</p>
<h5 id="make-object-of-component-class.">3.1 Make object of <code>Component</code> class.</h5>
<p>An argument is component name.</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python">cp <span class="op">=</span> cp.Component(<span class="st">&quot;sensor_ctl&quot;</span>)</code></pre></div>
<h5 id="add-signals-to-component-object-for-user-logic">3.2 Add signals to Component object for user logic</h5>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="co"># add functions add_*(name, bit) usage</span>
<span class="co"># @param name : signal name</span>
<span class="co"># @param bit  : bit width of signal</span>

<span class="co"># for this module (component)</span>
cp.add_input(<span class="st">&quot;clk&quot;</span>,<span class="dv">1</span>)
cp.add_input(<span class="st">&quot;rst&quot;</span>,<span class="dv">1</span>)

<span class="co"># for &quot;inout sig&quot; in user logic</span>
cp.add_inout(<span class="st">&quot;sig_out&quot;</span>,<span class="dv">1</span>)

<span class="co"># for &quot;finish&quot; and &quot;busy&quot; in user logic</span>
cp.add_wire(<span class="st">&quot;finish_flag&quot;</span>,<span class="dv">1</span>)
cp.add_wire(<span class="st">&quot;busy_flag&quot;</span>,<span class="dv">1</span>)</code></pre></div>
<p>Signals for <code>req</code> and <code>out_data</code> in user logic will be defined when communication logic is decided. Since the signals should be connected with CPU (software).</p>
<h5 id="select-communication-logic-and-add-signals-for-data-communication">3.3 Select communication logic and add signals for data communication</h5>
<p>In this Getting Started, the logic to communicate is <strong>Xillinux</strong> for free use. Xillinux is released by <a href="http://xillybus.com">Xillybus</a>. Xillinux is Ubuntu OS to run on a <strong>programmable SoC</strong> which equips FPGA and CPU like Zynq or Cyclone V and so on. It provides communication logic for FPGA and CPU communicate through FIFO buffers, and the FIFO width is 32 bit or 8 bit (due to free version). Controlling the FIFO buffers by circuit on FPGA side, FPGA and CPU can send or receive data each other.</p>
<p>cReComp supports the control logic for the FIFO buffers (32 bit and 8 bit) on Xillinux.</p>
<p>First, <strong>Some elements should be specified as arguments of a constructor for configuration</strong>, when developer use class object of <code>communication</code> like following code (this time, 32 bit is used).</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="co"># Xillybus_fifo(rcv_cycle, snd_cycle, rs_cond, fifo_width)</span>
<span class="co"># @param rcv_cycle  : times which user logic receives data from CPU</span>
<span class="co"># @param snd_cycle  : times which user logic sends data to CPU</span>
<span class="co"># @param rs_cond    : condition of timing to change receive or send</span>
<span class="co"># @param fifo_width : FIFO width of Xllibus IP</span>
fifo_32 <span class="op">=</span> com.Xillybus_fifo(<span class="dv">1</span>,<span class="dv">1</span>,<span class="st">&quot;finish_flag &amp;&amp; busy_flag != 0&quot;</span>, <span class="dv">32</span>)</code></pre></div>
<p>Second, <strong>it is necessary to prepare signals for data receiving and sending between user logic (FPGA) and CPU</strong>. So, please add the signals to component object and assign them to FIFO buffers.</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="co"># for register to receive data from CPU</span>
cp.add_reg(<span class="st">&quot;dummy&quot;</span>,<span class="dv">31</span>)
cp.add_reg(<span class="st">&quot;req_reg&quot;</span>,<span class="dv">1</span>)
<span class="co"># for wire to send data to CPU</span>
cp.add_wire(<span class="st">&quot;sensor_data&quot;</span>,<span class="dv">32</span>)

<span class="co"># &quot;req_reg&quot; and &quot;dummy&quot; is assigned the FIFO buffer for receiving</span>
fifo_32.assign(<span class="st">&quot;rcv&quot;</span>,<span class="st">&quot;req_reg&quot;</span>)
fifo_32.assign(<span class="st">&quot;rcv&quot;</span>, <span class="st">&quot;dummy&quot;</span>)

<span class="co"># &quot;sensor_data&quot; is assigned the FIFO buffer for receiving</span>
fifo_32.assign(<span class="st">&quot;snd&quot;</span>, <span class="st">&quot;sensor_data&quot;</span>)</code></pre></div>
<h5 id="assignment-of-user-logic-signals">3.4 Assignment of user logic signals</h5>
<p>The functions for assignment of user logic had been pre-defined by cReComp like following code. So, developer can use them directly.</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="co"># Sonic_sensor(uut)</span>
<span class="co"># usage:</span>
<span class="co"># @param uut : instance name of user logic</span>

sonic_sensor <span class="op">=</span> Sonic_sensor(<span class="st">&quot;uut&quot;</span>)


<span class="co"># assign(signame_u, signame_c)</span>
<span class="co"># usage:</span>
<span class="co"># @param signame_u  : signal name of user logic</span>
<span class="co"># @param signame_c : signal name of defined signal on your configuration</span>

sonic_sensor.assign(<span class="st">&quot;clk&quot;</span>,<span class="st">&quot;&quot;</span>)
sonic_sensor.assign(<span class="st">&quot;rst&quot;</span>,<span class="st">&quot;&quot;</span>)
sonic_sensor.assign(<span class="st">&quot;req&quot;</span>,<span class="st">&quot;&quot;</span>)
sonic_sensor.assign(<span class="st">&quot;busy&quot;</span>,<span class="st">&quot;&quot;</span>)
sonic_sensor.assign(<span class="st">&quot;sig&quot;</span>,<span class="st">&quot;&quot;</span>)
sonic_sensor.assign(<span class="st">&quot;finish&quot;</span>,<span class="st">&quot;&quot;</span>)
sonic_sensor.assign(<span class="st">&quot;out_data&quot;</span>,<span class="st">&quot;&quot;</span>)</code></pre></div>
<p>In assignments, please select the signal in the signals which you has defined already. The code when the assignments were completed is shown following.</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python">sonic_sensor <span class="op">=</span> Sonic_sensor(<span class="st">&quot;uut&quot;</span>)
sonic_sensor.assign(<span class="st">&quot;clk&quot;</span>,<span class="st">&quot;clk&quot;</span>)
sonic_sensor.assign(<span class="st">&quot;rst&quot;</span>,<span class="st">&quot;rst&quot;</span>)
sonic_sensor.assign(<span class="st">&quot;req&quot;</span>,<span class="st">&quot;req_reg&quot;</span>)
sonic_sensor.assign(<span class="st">&quot;busy&quot;</span>,<span class="st">&quot;busy_flag&quot;</span>)
sonic_sensor.assign(<span class="st">&quot;sig&quot;</span>,<span class="st">&quot;sig_out&quot;</span>)
sonic_sensor.assign(<span class="st">&quot;finish&quot;</span>,<span class="st">&quot;finish_flag&quot;</span>)
sonic_sensor.assign(<span class="st">&quot;out_data&quot;</span>,<span class="st">&quot;sensor_data&quot;</span>)</code></pre></div>
<h5 id="add-configuration-of-user-logic-and-communication-to-your-component">3.5 Add configuration of user logic and communication to your component</h5>
<p>Please add the objects your component.</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python">cp.add_ul(sonic_sensor)
cp.add_com(fifo_32)</code></pre></div>
<h5 id="componentization">3.6 Componentization</h5>
<p>Finally, add function for componentization.</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python">cp.componentize()</code></pre></div>
<h3 id="configuration-is-finished">4. Configuration is finished</h3>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python">
<span class="co"># sensor_ctl.py</span>

<span class="co">#!/usr/bin/python</span>
<span class="co"># -*- coding: utf-8 -*-</span>

<span class="im">import</span> crecomp.userlogic <span class="im">as</span> ul
<span class="im">import</span> crecomp.component <span class="im">as</span> cp
<span class="im">import</span> crecomp.verilog <span class="im">as</span> vl
<span class="im">import</span> crecomp.communication <span class="im">as</span> com

<span class="kw">class</span> Sonic_sensor(ul.Util):

    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>,uut):
        <span class="va">self</span>.name <span class="op">=</span> <span class="st">&quot;sonic_sensor&quot;</span>
        <span class="va">self</span>.filepath <span class="op">=</span> <span class="st">&quot;../verilog/sonic_sensor.v&quot;</span>
        <span class="va">self</span>.uut <span class="op">=</span> uut
        <span class="va">self</span>.ports <span class="op">=</span>[
        vl.Input(<span class="st">&quot;clk&quot;</span>, <span class="dv">1</span>),
        vl.Input(<span class="st">&quot;rst&quot;</span>, <span class="dv">1</span>),
        vl.Input(<span class="st">&quot;req&quot;</span>, <span class="dv">1</span>),
        vl.Output(<span class="st">&quot;busy&quot;</span>, <span class="dv">1</span>),
        vl.Inout(<span class="st">&quot;sig&quot;</span>, <span class="dv">1</span>),
        vl.Output(<span class="st">&quot;finish&quot;</span>, <span class="dv">1</span>),
        vl.Output(<span class="st">&quot;out_data&quot;</span>, <span class="dv">32</span>)
        ]
        <span class="va">self</span>.assignlist <span class="op">=</span> {}

cp <span class="op">=</span> cp.Component(<span class="st">&quot;sensor_ctl&quot;</span>)

cp.add_input(<span class="st">&quot;clk&quot;</span>,<span class="dv">1</span>)
cp.add_input(<span class="st">&quot;rst&quot;</span>,<span class="dv">1</span>)
cp.add_inout(<span class="st">&quot;sig_out&quot;</span>,<span class="dv">1</span>)
cp.add_wire(<span class="st">&quot;finish_flag&quot;</span>,<span class="dv">1</span>)
cp.add_wire(<span class="st">&quot;busy_flag&quot;</span>,<span class="dv">1</span>)

fifo_32 <span class="op">=</span> com.Xillybus_fifo(<span class="dv">1</span>,<span class="dv">1</span>,<span class="st">&quot;finish_flag &amp;&amp; busy_flag != 0&quot;</span>, <span class="dv">32</span>)
cp.add_reg(<span class="st">&quot;dummy&quot;</span>,<span class="dv">31</span>)
cp.add_reg(<span class="st">&quot;req_reg&quot;</span>,<span class="dv">1</span>)
cp.add_wire(<span class="st">&quot;sensor_data&quot;</span>,<span class="dv">32</span>)

fifo_32.assign(<span class="st">&quot;rcv&quot;</span>,<span class="st">&quot;req_reg&quot;</span>)
fifo_32.assign(<span class="st">&quot;rcv&quot;</span>, <span class="st">&quot;dummy&quot;</span>)
fifo_32.assign(<span class="st">&quot;snd&quot;</span>, <span class="st">&quot;sensor_data&quot;</span>)

sonic_sensor <span class="op">=</span> Sonic_sensor(<span class="st">&quot;uut&quot;</span>)
sonic_sensor.assign(<span class="st">&quot;clk&quot;</span>,<span class="st">&quot;clk&quot;</span>)
sonic_sensor.assign(<span class="st">&quot;rst&quot;</span>,<span class="st">&quot;rst&quot;</span>)
sonic_sensor.assign(<span class="st">&quot;req&quot;</span>,<span class="st">&quot;req_reg&quot;</span>)
sonic_sensor.assign(<span class="st">&quot;busy&quot;</span>,<span class="st">&quot;busy_flag&quot;</span>)
sonic_sensor.assign(<span class="st">&quot;sig&quot;</span>,<span class="st">&quot;sig_out&quot;</span>)
sonic_sensor.assign(<span class="st">&quot;finish&quot;</span>,<span class="st">&quot;finish_flag&quot;</span>)
sonic_sensor.assign(<span class="st">&quot;out_data&quot;</span>,<span class="st">&quot;sensor_data&quot;</span>)

cp.add_ul(sonic_sensor)
cp.add_com(fifo_32)

cp.componentize()</code></pre></div>
<h4 id="generate-component">5. Generate component</h4>
<p>Please run your script.</p>
<pre><code>$ python sensor_ctl.py</code></pre>
<h4 id="the-component-was-generated-by-crecomp">6. The component was generated by cReComp</h4>
<p>A directly named your component name is generated when componentization was successful.<br />
<a href="sensor_ctl.zip">Download sensor_ctl.zip</a></p>
<pre><code>sensor_ctl/
|-hardware/
|---sensor_ctl.v
|---sonic_sensor.v
|-software/
|---sensor_ctl.cpp
|---lib_cpp.h
|---Makefile</code></pre>
